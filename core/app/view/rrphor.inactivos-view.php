<?php
// Resumen de Asistencia de Activos$client = ClientData::getTotal(); $ano=date("Y");
if(!isset($_SESSION['cliente']))  $_SESSION['cliente']=1;if(!isset($_SESSION['mes']))      $_SESSION['mes']=date("m");
if(isset($_GET['cliente'])){	$cliente=$_GET['cliente'];	$_SESSION['cliente']=$cliente;}else{	$cliente=$_SESSION['cliente'];}
if(isset($_GET['mes'])){	$mes=$_GET['mes'];	$_SESSION['mes']=$mes;}else{	$mes=$_SESSION['mes'];}
$fecha=$ano."-".$mes."-01";$total=date("t", strtotime($fecha));$dia=date("w", strtotime($fecha));
$ini="2020-01-01"; $fin=$ano."-".str_pad($mes, 2, "0", STR_PAD_LEFT)."-30"; $lugar=$_SESSION['id'];
?><section class="content-header">	<h1>		R.R.H.H.		<small>resumen de la asistencia de los agentes inactivos</small>	</h1>	<ol class="breadcrumb">		<li><a href="index.php?view=home"><i class="fa fa-book"></i> Panel de Control </a></li>		<li class="active"> Asistencia </li>	</ol></section><form class="form-horizontal" method="post" id="addproduct" enctype="multipart/form-data" role="form">	<div class="col-xs-12" style="padding: 1.5rem !important;">		<div class="box">			<div class="box-header with-border">				<label> Cliente: </label>				<select class="select-input form-control input-sm" id="idclient" name="idclient" onchange="javascript:location.href='index.php?view=rrphor.inactivos&cliente='+value;">					<option value="0" selected="selected"> Selecione... </option>					<?php foreach($client as $clients): ?>							<option value="<?php echo $clients->idclient; ?>" <?php if($clients->idclient == $cliente) echo 'selected="selected"'; ?>><?php echo $clients->nombre; //utf8_encode() ?></option> 					<?php endforeach; ?>				</select>				</div>			<div class="box-body mailbox-messages">				<div class="row">					<div class="col-sm-6">						<div class="dataTables_length" id="example_length">							<label>Ver el reporte de asistencia de:&nbsp;								<select style="width: 120px; display: inline-block;" id="mes_id" name="mes_id" class="form-control" onchange="javascript:location.href='?view=rrphor.activos&mes='+value;">									<option value= "1" <?php if($mes == '01') echo 'selected'; ?>>Enero</option>									<option value= "2" <?php if($mes == '02') echo 'selected'; ?>>Febrero</option>									<option value= "3" <?php if($mes == '03') echo 'selected'; ?>>Marzo</option>									<option value= "4" <?php if($mes == '04') echo 'selected'; ?>>Abril</option>									<option value= "5" <?php if($mes == '05') echo 'selected'; ?>>Mayo</option>									<option value= "6" <?php if($mes == '06') echo 'selected'; ?>>Junio</option>									<option value= "7" <?php if($mes == '07') echo 'selected'; ?>>Julio</option>									<option value= "8" <?php if($mes == '08') echo 'selected'; ?>>Agosto</option>									<option value= "9" <?php if($mes == '09') echo 'selected'; ?>>Septiembre</option>									<option value="10" <?php if($mes == '10') echo 'selected'; ?>>Octubre</option>									<option value="11" <?php if($mes == '11') echo 'selected'; ?>>Noviembre</option>									<option value="12" <?php if($mes == '12') echo 'selected'; ?>>Diciembre</option>								</select>								&nbsp;&nbsp;Total de dias del periodo: <?php echo $total; ?>							</label>						</div>					</div>				</div>				</br>				<table id="viewBitacora" class="table table-bordered table-hover">					<thead>						<tr>							<th style="width:18%"><div align="center">Agentes</div></th>							<th style="width: 7%"><div align="center">Dias Laborados</div></th>							<th style="width: 7%"><div align="center">Noches Laboradas</div></th>							<th style="width: 7%"><div align="center">Nro. Faltas</div></th>							<th style="width: 7%"><div align="center">Dias</br> Libres</div></th>							<th style="width: 7%"><div align="center">Libre Trabajado</div></th>							<th style="width: 7%"><div align="center">Total de Dias</div></th>							<th style="width: 7%"><div align="center">Turnos dobles</div></th>							<th style="width: 7%"><div align="center">Total</br> doble</div></th>							<th style="width: 7%"><div align="center">Dias con Moto</div></th>							<th style="width: 7%"><div align="center">Noche con Moto</div></th>							<th style="width: 7%"><div align="center">Total</br> Moto</div></th>							<th><div align="center">Fin del Contrato</div></th>						</tr>					</thead>					<tbody>						<?php							// Consulta de las Nominas							$users = PuestoData::getByIdCliente($cliente, 3, 0, $ini, $fin);var_dump($users);
							// Crea tabla de los horarios							foreach($users as $tables) {								$valor=HorarioData::getByIdHorario($tables['servicio'], $tables['id'], $mes, $ano, 2);																	if(count(PuestoData::getByLibre($tables['id'])) == 1){									$tipo = 'Agente'; 									//$valor=HorarioData::getByIdHorario($tables['servicio'], $tables['id'], $mes, $ano, 2);																			}else{									$tipo = 'Saca Franco'; 															//$valor=HorarioData::getByIdHorarioAll($tables['id'], $mes, $ano, 2);															} 
								$diasla = 0; $nochel = 0; $libres = 0; $faltas = 0; $libret = 0; 								$nochem = 0; $diassm = 0; $totalm = 0; $totals = 0; $noched = 0; 								$diassd = 0; $acuerdo = 0; $renuncio = '';			
								$resultado = count($valor);
								for ($i = 1; $i <= $total; $i++) {									if($resultado > 0) {										if($valor[$i-1]['turno']==1) {//dia											$diasla++;										}else{
											if($valor[$i-1]['turno']==2) {// noche
												$nochel++;
											}else{
												if($valor[$i-1]['turno']==3) {// libres
													$libres++;
												}else{
													if($valor[$i-1]['turno']==4) {// faltas
														$faltas++;
													}else{
														if($valor[$i-1]['turno']==5) {// libre trabajado
															$libret++;
														}else{
															if($valor[$i-1]['turno']==6) {// turno doble noche
																$noched++; $diasla++;
															}else{
																if($valor[$i-1]['turno']==7) {// turno doble dia
																	$diassd++; $nochel++;
																}else{
																	if($valor[$i-1]['turno']==8) {// turno doble dia
																		$diassm++;
																	}else{
																		if($valor[$i-1]['turno']==9) {// turno dia moto
																			$nochem++;
																		}else{
																			if($valor[$i-1]['turno']==10) {// turno doble dia
																				$renuncio = $valor[$i-1]['ano'].'-'.str_pad($valor[$i-1]['mes'], 2, "0", STR_PAD_LEFT).'-'.str_pad($valor[$i-1]['dia'], 2, "0", STR_PAD_LEFT);																				$acuerdo = 1;
																			}																		}																	}																}															}														}													}												}											}										}									}
									$totals = $diasla+$nochel+$libres+$libret+$acuerdo;									$totala = $libret+($noched+$diassd);									$totalm = $diassm+$nochem;								}
								echo '<tr>';									echo '<td style="width:17%">';										echo '<small>';											echo $tables['nombre']; // substr($tables['nombre'], 0, 31); // utf8_encode(); // $tables['id'].'-'.											echo '</br>'.$tables['descripcion'].' ('.$tables['id'].')</br>'.$tipo; // $tables['servicio'].' '.										echo '</small>';									echo '</td>';																			echo '<td style="width:7%"><div align="center">'.$diasla.'</div></td>';									echo '<td style="width:7%"><div align="center">'.$nochel.'</div></td>';									echo '<td style="width:7%"><div align="center">'.$faltas.'</div></td>';									echo '<td style="width:7%"><div align="center">'.$libres.'</div></td>';									echo '<td style="width:7%"><div align="center">'.$libret.'</div></td>';									echo '<td style="width:7%"><div align="center"><span class="text-danger">'.$totals.'</span></div></td>';									echo '<td style="width:7%"><div align="center">'.($noched+$diassd).'</div></td>';									echo '<td style="width:7%"><div align="center"><span class="text-danger">'.$totala.'</span></div></td>';									echo '<td style="width:7%"><div align="center">'.$diassm.'</div></td>';									echo '<td style="width:7%"><div align="center">'.$nochem.'</div></td>';									echo '<td style="width:7%"><div align="center"><span class="text-danger">'.$totalm.'</span></div></td>';									echo '<td><div align="center">'.$renuncio.'</div></td>';								echo '</tr>';							} 						?>					</tbody>				</table>
			</div>		</div>	</div></form><script>    var element = document.getElementById("sidai");
    element.classList.add("sidebar-collapse");    document.title = "Near Solutions | Resumen de asistencia activos";</script>